# Voice Book - 需求文档

最后更新: 2025-11-29

## 📋 项目概述

**项目名称**: Voice Book
**项目类型**: 离线本地有声书播放器
**技术栈**: Flutter + Provider + SQLite + Just Audio
**核心理念**: 低资源占用 + 隐私保护

## 🎯 项目目标

打造一款专注于本地有声书播放的应用，特点：
- ✅ 完全离线，无需网络
- ✅ 低资源占用，流畅运行
- ✅ 保护用户隐私，不收集数据
- ✅ 简洁易用的界面

## 📊 功能需求

### 1. 核心功能（高优先级）

#### REQ-001: 音频文件管理
- **优先级**: 高
- **预计时间**: 3天
- **状态**: 待开发
- **描述**: 实现本地音频文件的扫描、导入和管理
- **验收标准**:
  - [ ] 支持扫描设备上的音频文件（mp3, m4a, wav等）
  - [ ] 支持手动导入音频文件
  - [ ] 支持按书籍分组管理
  - [ ] 支持文件元数据读取（标题、作者、时长等）
  - [ ] 文件列表加载时间 < 1秒

#### REQ-002: 音频播放功能
- **优先级**: 高
- **预计时间**: 4天
- **状态**: 待开发
- **描述**: 实现完整的音频播放控制功能
- **验收标准**:
  - [ ] 支持播放、暂停、停止
  - [ ] 支持进度条拖动
  - [ ] 支持倍速播放（0.5x - 2.0x）
  - [ ] 支持定时关闭
  - [ ] 支持后台播放
  - [ ] 播放响应时间 < 500ms

#### REQ-003: 播放进度记忆
- **优先级**: 高
- **预计时间**: 2天
- **状态**: 待开发
- **描述**: 自动保存和恢复播放进度
- **验收标准**:
  - [ ] 自动保存每个文件的播放进度
  - [ ] 重新打开应用时恢复上次播放位置
  - [ ] 支持多个文件的进度独立记忆
  - [ ] 进度保存延迟 < 100ms

#### REQ-004: 书籍管理
- **优先级**: 高
- **预计时间**: 3天
- **状态**: 待开发
- **描述**: 实现书籍的组织和管理功能
- **验收标准**:
  - [ ] 支持创建书籍（书名、作者、封面）
  - [ ] 支持将音频文件添加到书籍
  - [ ] 支持书籍列表展示
  - [ ] 支持书籍搜索
  - [ ] 支持书籍删除和编辑

### 2. 增强功能（中优先级）

#### REQ-005: 书籍播放位置记忆
- **优先级**: 中
- **预计时间**: 1天
- **状态**: 待开发
- **描述**: 记录每本书籍当前播放的音频位置，进入书籍时自动定位
- **验收标准**:
  - [ ] 记录每本书籍当前播放的音频ID
  - [ ] 进入书籍详情页时，自动滚动到当前播放的音频
  - [ ] 支持高亮显示当前播放的音频
  - [ ] 切换音频时自动更新记录

#### REQ-006: 迷你播放器悬浮框
- **优先级**: 中
- **预计时间**: 2天
- **状态**: 待开发
- **描述**: 在主页右下角显示迷你播放器，实时同步播放状态
- **验收标准**:
  - [ ] 固定在右下角的悬浮播放框
  - [ ] 显示正在播放的音频标题（过长时滚动显示）
  - [ ] 显示播放/暂停状态图标（动态切换）
  - [ ] 点击跳转到完整播放页面
  - [ ] 支持播放/暂停快捷操作
  - [ ] 固定尺寸，响应式布局

#### REQ-007: 独立播放页面
- **优先级**: 中
- **预计时间**: 1天
- **状态**: 待开发
- **描述**: 将播放页面独立为主页Tab，默认进入该页面
- **验收标准**:
  - [ ] 主页底部导航改为三个Tab：书架/正在播放/设置
  - [ ] 正在播放Tab显示完整播放器界面
  - [ ] 显示当前播放或上次退出前播放的音频
  - [ ] App启动时默认进入"正在播放"页面
  - [ ] 无播放内容时显示引导界面

#### REQ-008: 书签功能
- **优先级**: 中
- **预计时间**: 2天
- **状态**: 待开发
- **描述**: 支持在播放过程中添加书签
- **验收标准**:
  - [ ] 支持添加书签（时间点 + 备注）
  - [ ] 支持书签列表查看
  - [ ] 支持跳转到书签位置
  - [ ] 支持书签删除

#### REQ-009: 播放列表
- **优先级**: 中
- **预计时间**: 2天
- **状态**: 待开发
- **描述**: 支持创建和管理播放列表
- **验收标准**:
  - [ ] 支持创建自定义播放列表
  - [ ] 支持添加/删除播放列表中的文件
  - [ ] 支持播放列表顺序调整
  - [ ] 支持连续播放

#### REQ-010: 睡眠定时器
- **优先级**: 中
- **预计时间**: 1天
- **状态**: 待开发
- **描述**: 支持定时停止播放
- **验收标准**:
  - [ ] 支持设置定时时长（5分钟、10分钟、30分钟、自定义）
  - [ ] 支持倒计时显示
  - [ ] 支持取消定时
  - [ ] 到时自动停止播放并保存进度

#### REQ-011: 通知栏和锁屏页控制
- **优先级**: 中
- **预计时间**: 3天
- **状态**: 待开发
- **描述**: 实现后台播放、通知栏控制和锁屏页控制功能
- **验收标准**:
  - [ ] 应用启动时申请通知权限和锁屏页权限
  - [ ] 播放时常驻通知栏，显示播放状态
  - [ ] 通知栏显示音频标题、书籍名称、封面图片
  - [ ] 通知栏支持上一个、下一个、播放/暂停操作
  - [ ] 锁屏页显示播放控制界面
  - [ ] 锁屏页支持上一个、下一个、播放/暂停操作
  - [ ] 支持后台播放（应用切换到后台时继续播放）
  - [ ] 通知栏和锁屏页状态与应用内实时同步
  - [ ] 点击通知栏跳转到播放器页面

### 3. 优化功能（低优先级）

#### REQ-012: 主题切换
- **优先级**: 低
- **预计时间**: 1天
- **状态**: 待开发
- **描述**: 支持明暗主题切换
- **验收标准**:
  - [ ] 支持浅色主题
  - [ ] 支持深色主题
  - [ ] 支持跟随系统主题
  - [ ] 主题切换流畅无闪烁

#### REQ-013: 数据备份与恢复
- **优先级**: 低
- **预计时间**: 2天
- **状态**: 待开发
- **描述**: 支持用户数据的备份和恢复
- **验收标准**:
  - [ ] 支持导出数据库到本地文件
  - [ ] 支持从备份文件恢复数据
  - [ ] 备份文件包含播放进度、书签、书籍信息
  - [ ] 恢复过程有进度提示

#### REQ-014: 书籍文件夹重新扫描
- **优先级**: 中
- **预计时间**: 1天
- **状态**: 待开发
- **描述**: 支持对已导入书籍的源文件夹进行重新扫描，同步文件变更
- **背景**: 用户可能会更新文件夹中的音频文件（新增、删除、替换），需要将这些变更同步到书籍中
- **验收标准**:
  - [ ] Book 模型新增 `sourceFolderPath` 字段，记录导入时的源文件夹路径
  - [ ] 书籍详情页显示"重新扫描"按钮（仅当 sourceFolderPath 存在时显示）
  - [ ] 重新扫描时检测文件变更：
    - 新增文件：添加到书籍音频列表末尾
    - 删除文件：从书籍中移除对应音频记录（保留播放进度历史）
    - 文件内容变更：更新元数据（时长、大小等）
  - [ ] 扫描过程显示进度提示
  - [ ] 扫描完成后显示变更摘要（新增 X 个，删除 X 个，更新 X 个）
  - [ ] 支持用户确认变更后再应用（可选）
  - [ ] 源文件夹不存在时给出友好提示
- **技术要点**:
  - 通过文件路径匹配现有音频记录
  - 使用文件修改时间或哈希值检测内容变更
  - 保持现有音频的 sortOrder 不变，新文件追加到末尾

## 🔧 非功能需求

### 性能要求
- 应用启动时间 < 2秒
- 音频文件列表加载时间 < 1秒
- 播放响应时间 < 500ms
- 内存占用 < 100MB（播放状态）
- 电池消耗：后台播放1小时 < 5%

### 兼容性要求
- Android 5.0+ (API 21+)
- iOS 12.0+
- 支持主流音频格式：MP3, M4A, AAC, WAV, FLAC

### 隐私要求
- 不收集用户数据
- 不需要网络权限
- 仅申请必要的权限：
  - 存储权限（读取音频文件）
  - 通知权限（显示播放控制）
  - 锁屏页权限（锁屏控制）
- 所有数据存储在本地

### 可用性要求
- 界面简洁直观
- 操作流程不超过3步
- 支持横竖屏切换
- 支持无障碍功能

## 📅 开发计划

### 第一阶段：MVP（预计2周）
- REQ-001: 音频文件管理
- REQ-002: 音频播放功能
- REQ-003: 播放进度记忆
- REQ-004: 书籍管理

### 第二阶段：增强功能（预计1周）
- REQ-005: 书籍播放位置记忆
- REQ-006: 迷你播放器悬浮框
- REQ-007: 独立播放页面
- REQ-008: 书签功能
- REQ-009: 播放列表
- REQ-010: 睡眠定时器
- REQ-011: 通知栏和锁屏页控制

### 第三阶段：优化完善（预计1周）
- REQ-012: 主题切换
- REQ-013: 数据备份与恢复
- 性能优化
- Bug修复

## 📝 变更记录

| 日期 | 版本 | 变更内容 | 变更人 |
|------|------|----------|--------|
| 2025-12-07 | 1.3 | 新增REQ-014（书籍文件夹重新扫描） | AI |
| 2025-12-01 | 1.2 | 新增REQ-011（通知栏和锁屏页控制），调整REQ编号 | AI |
| 2025-11-30 | 1.1 | 新增REQ-005/006/007（播放位置记忆、迷你播放器、独立播放页） | AI |
| 2025-11-29 | 1.0 | 初始版本 | AI |

## 🔗 相关文档

- [项目状态](./项目状态.md)
- [待办清单](./待办清单.md)
