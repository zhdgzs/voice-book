# Voice Book - 待办事项清单

最后更新: 2025-12-01

## 🔥 高优先级（紧急重要）

### 1. 实现书籍播放位置记忆 (REQ-005)
- **截止日期**: 2025-12-14
- **预计工作量**: 1天
- **依赖**: 音频播放功能完成
- **描述**: 记录每本书籍当前播放的音频位置，进入书籍时自动定位
- **详细任务**:
  - [ ] 在 books 表中添加 current_audio_id 字段
  - [ ] 在 AudioPlayerProvider 中切换音频时更新书籍的当前音频
  - [ ] 在 BookDetailScreen 中进入时自动滚动到当前播放音频
  - [ ] 高亮显示当前播放的音频项
  - [ ] 测试多本书籍的位置记忆

### 2. 实现独立播放页面 (REQ-007)
- **截止日期**: 2025-12-17
- **预计工作量**: 1天
- **依赖**: 音频播放功能完成
- **描述**: 将播放页面独立为主页Tab，默认进入该页面
- **详细任务**:
  - [ ] 修改主页底部导航为三个Tab：书架/正在播放/设置
  - [ ] 将 PlayerScreen 集成到"正在播放"Tab
  - [ ] 实现无播放内容时的引导界面
  - [ ] 设置 App 启动时默认进入"正在播放"页面
  - [ ] 保存用户最后访问的 Tab（可选）
  - [ ] 测试页面切换流畅性

## 📌 中优先级（重要不紧急）

### 3. 实现播放列表 (REQ-009)
- **截止日期**: 2025-12-21
- **预计工作量**: 2天
- **依赖**: 音频播放功能完成
- **描述**: 支持创建和管理播放列表
- **详细任务**:
  - [ ] 实现播放列表创建
  - [ ] 实现播放列表管理
  - [ ] 实现连续播放
  - [ ] 实现播放顺序调整

### 4. 实现后台播放和锁屏控制 (REQ-011)
- **截止日期**: 2025-12-23
- **预计工作量**: 2天
- **依赖**: 音频播放功能完成
- **描述**: 支持后台播放和锁屏控制
- **详细任务**:
  - [ ] 集成 audio_service 包
  - [ ] 实现后台播放
  - [ ] 实现锁屏控制界面
  - [ ] 实现通知栏控制
  - [ ] 测试后台播放稳定性

## 💡 低优先级（可延后）

### 5. 实现数据备份与恢复 (REQ-012)
- **截止日期**: 2025-12-27
- **预计工作量**: 2天
- **描述**: 支持用户数据的备份和恢复
- **详细任务**:
  - [ ] 实现数据导出
  - [ ] 实现数据导入
  - [ ] 实现备份文件管理
  - [ ] 添加进度提示

### 6. 性能优化
- **截止日期**: 2025-12-27
- **预计工作量**: 2天
- **描述**: 优化应用性能和用户体验
- **详细任务**:
  - [ ] 优化启动速度
  - [ ] 优化列表加载性能
  - [ ] 优化内存占用
  - [ ] 优化电池消耗

### 7. 添加单元测试
- **截止日期**: 2025-12-29
- **预计工作量**: 2天
- **描述**: 为核心功能添加单元测试
- **详细任务**:
  - [ ] 为 Model 类添加测试
  - [ ] 为 Provider 添加测试
  - [ ] 为 Service 添加测试
  - [ ] 提高测试覆盖率到 60%+

## 🔄 进行中

暂无进行中的任务

## ✅ 最近完成

### 睡眠定时器功能 (完成于 2025-11-30)
- [x] 实现睡眠定时器 (REQ-010)
  - 耗时: 1天
  - 说明: 支持按分钟和按集数两种定时模式
  - 特性:
    - 按分钟定时（5-120分钟，支持自定义）
    - 按集数定时（1-99集，支持自定义）
    - 倒计时显示和延长功能
    - 自动停止播放
    - 定时器取消功能
  - 文件: `lib/models/sleep_timer.dart`, `lib/providers/sleep_timer_provider.dart`, `lib/widgets/sleep_timer_dialog.dart`

### 书签功能 (完成于 2025-11-30)
- [x] 实现书签功能 (REQ-008)
  - 耗时: 1天
  - 说明: 支持在播放过程中添加和管理书签
  - 特性:
    - 书签添加（支持自定义标题和备注）
    - 书签列表展示
    - 书签跳转播放
    - 书签删除
  - 文件: `lib/models/bookmark.dart`, `lib/widgets/bookmark_list_dialog.dart`

### 迷你播放器组件 (完成于 2025-11-30)
- [x] 实现迷你播放器悬浮框 (REQ-006)
  - 耗时: 1天
  - 说明: 在主页右下角显示迷你播放器，实时同步播放状态
  - 特性:
    - 固定在右下角的悬浮布局
    - 显示正在播放的音频标题
    - 标题过长时自动滚动动画
    - 播放/暂停状态图标动态切换
    - 点击跳转到完整播放页
    - 播放/暂停快捷操作
  - 文件: `lib/widgets/mini_player.dart`

### 跳过功能和自动播放 (完成于 2025-11-30)
- [x] 实现跳过开头和结尾功能
  - 耗时: 1天
  - 说明: 支持用户自定义跳过音频开头和结尾的时长
  - 特性: Slider 进度条（0-120秒）、全局设置、双入口设置
  - 文件: `lib/providers/settings_provider.dart`

- [x] 实现自动播放下一个功能
  - 耗时: 0.5天
  - 说明: 播放完成后自动播放下一个音频
  - 特性: 开关控制、与跳过结尾配合、防重复触发
  - 文件: `lib/providers/audio_player_provider.dart`

### 主题切换功能 (完成于 2025-11-30)
- [x] 实现主题切换 (REQ-011)
  - 耗时: 0.5天
  - 说明: 支持明暗主题切换
  - 特性:
    - 浅色主题
    - 深色主题
    - 跟随系统主题
    - 主题持久化保存
  - 文件: `lib/providers/settings_provider.dart`, `lib/main.dart`

### 音频播放功能 (完成于 2025-11-30)
- [x] 实现音频播放功能 (REQ-002)
  - 耗时: 2天
  - 说明: 实现完整的音频播放控制功能
  - 特性:
    - 集成 just_audio 播放器
    - 播放/暂停/停止控制
    - 进度条和拖动
    - 倍速播放（0.5x - 2.0x）
    - 播放器 UI
  - 文件: `lib/providers/audio_player_provider.dart`, `lib/screens/player_screen.dart`

### 播放进度记忆 (完成于 2025-11-30)
- [x] 实现播放进度记忆 (REQ-003)
  - 耗时: 1天
  - 说明: 自动保存和恢复播放进度
  - 特性:
    - 进度自动保存
    - 进度恢复
    - 多文件进度管理
  - 文件: `lib/providers/audio_player_provider.dart`, `lib/models/playback_progress.dart`

### 音频文件管理功能 (完成于 2025-11-29)
- [x] 实现音频文件管理功能 (REQ-001)
  - 耗时: 3天
  - 说明: 实现本地音频文件的扫描、导入和管理
  - 特性:
    - 文件扫描服务（递归扫描）
    - 文件导入功能
    - 文件列表展示
    - 文件元数据读取
    - 权限请求处理
  - 文件: `lib/services/file_scanner_service.dart`, `lib/services/audio_metadata_service.dart`, `lib/services/permission_service.dart`, `lib/screens/file_import_screen.dart`

### 书籍管理功能 (完成于 2025-11-29)
- [x] 实现书籍管理功能 (REQ-004)
  - 耗时: 2天
  - 说明: 实现书籍的组织和管理功能
  - 特性:
    - 书籍创建
    - 书籍列表
    - 书籍详情页
    - 书籍编辑和删除
  - 文件: `lib/providers/book_provider.dart`, `lib/screens/book_list_screen.dart`, `lib/screens/book_detail_screen.dart`

### 基础架构搭建 (完成于 2025-11-29)
- [x] 搭建项目基础架构
  - 耗时: 2天
  - 说明: 创建项目目录结构、基础模型、数据库设计
  - 特性:
    - 标准目录结构（models/providers/screens/widgets/services/utils）
    - 数据库表结构（books/audio_files/playback_progress/bookmarks）
    - 基础 Model 类（Book/AudioFile/PlaybackProgress/Bookmark）
    - Provider 架构（BookProvider/AudioPlayerProvider/SettingsProvider）
  - 文件: `lib/services/database_service.dart`, `lib/models/*.dart`, `lib/providers/*.dart`

### 项目初始化 (完成于 2025-11-29)
- [x] 创建 Flutter 项目
  - 耗时: 1天
  - 说明: 完成项目基础结构创建
  - 特性:
    - Flutter 项目创建
    - 核心依赖添加（provider/sqflite/just_audio/shared_preferences）
    - 项目管理文档创建
  - 文件: `pubspec.yaml`, `docs/*.md`

## 📊 任务统计

- **总任务数**: 15 个需求
- **已完成**: 11 个 (73%)
  - REQ-001: 音频文件管理 ✅
  - REQ-002: 音频播放功能 ✅
  - REQ-003: 播放进度记忆 ✅
  - REQ-004: 书籍管理功能 ✅
  - REQ-006: 迷你播放器悬浮框 ✅
  - REQ-008: 书签功能 ✅
  - REQ-010: 睡眠定时器 ✅
  - REQ-011: 主题切换 ✅
  - 跳过开头/结尾功能 ✅
  - 自动播放下一个 ✅
  - 基础架构 ✅
- **进行中**: 0 个 (0%)
- **待办**: 4 个 (27%)
  - 高优先级: 2 个
  - 中优先级: 2 个
  - 低优先级: 3 个

## 🎯 本周计划 (2025-12-01 至 2025-12-07)

1. **周日**: 实现书籍播放位置记忆（REQ-005）
2. **周一**: 实现独立播放页面（REQ-007）
3. **周二-周三**: 实现播放列表管理（REQ-009）
4. **周四-周五**: 实现后台播放和锁屏控制（REQ-011）

## 📅 本月目标 (2025-12)

- ✅ 完成 MVP 版本开发（REQ-001 至 REQ-004）
- ✅ 完成核心增强功能
  - ✅ 跳过开头/结尾功能
  - ✅ 自动播放下一个
  - ✅ 书签功能（REQ-008）
  - ✅ 睡眠定时器（REQ-010）
  - ✅ 迷你播放器（REQ-006）
  - ✅ 主题切换（REQ-011）
- 🚧 完成剩余增强功能
  - ⏳ 书籍播放位置记忆（REQ-005）
  - ⏳ 独立播放页面（REQ-007）
  - ⏳ 播放列表管理（REQ-009）
  - ⏳ 后台播放和锁屏控制
- 📋 可选优化功能
  - 数据备份与恢复（REQ-012）
  - 性能优化
  - 单元测试
- 🎯 准备正式版本发布

## 💡 注意事项

- ⚠️ 开发过程中严格遵循 Flutter 最佳实践
- ⚠️ 确保代码注释完整，便于后期维护
- ⚠️ 每完成一个功能模块，运行 `/update-status` 更新项目状态
- ⚠️ 定期进行代码审查，保证代码质量
- ⚠️ 注意性能优化，确保低资源占用

## 🔗 相关文档

- [需求文档](./需求文档.md)
- [项目状态](./项目状态.md)
